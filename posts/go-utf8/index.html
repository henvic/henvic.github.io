<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>UTF-8 strings with Go: len(s) isn&#39;t enough | Henrique Vicente</title>
    <link href="https://fonts.googleapis.com/css?family=Raleway|Fira+Code|Comfortaa:300" rel="stylesheet">
    <link rel="stylesheet" href="/css/foundation-icons.css">
    <link rel="stylesheet" href="/css/foundation.min.css">
    <link rel="stylesheet" href="/webicons/webicons.css">
    <link rel="stylesheet" href="/css/syntax.css">
    <link rel="stylesheet" href="/css/henvic.css">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta property="og:title" content="UTF-8 strings with Go: len(s) isn&#39;t enough | Henrique Vicente">
    <meta name="twitter:title" content="UTF-8 strings with Go: len(s) isn&#39;t enough | Henrique Vicente" />
    <meta property="og:url" content="https://henvic.dev/posts/go-utf8/">
    
    <meta name="description" content="In this post, I show you the bare minimum you need to know how to do UTF-8 string manipulation in Go safely.">
    <meta property="og:description" content="In this post, I show you the bare minimum you need to know how to do UTF-8 string manipulation in Go safely.">
    <meta name="twitter:description" content="In this post, I show you the bare minimum you need to know how to do UTF-8 string manipulation in Go safely." />
    
    
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="2022-03-07">
    
    <meta property="twitter:url" content="https://henvic.dev/posts/go-utf8/">
    
    <meta name="og:image" content="https://henvic.dev/img/posts/go/go-logo-blue.png" />
    <meta name="twitter:image" content="https://henvic.dev/img/posts/go/go-logo-blue.png" />
    
    <script data-ad-client="ca-pub-3943822340584499" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head>
<body><div class="grid-y medium-grid-frame">
        <nav class="title-bar show-for-small-only" data-responsive-toggle="responsive-menu" data-hide-for="medium">
    <button class="menu-icon" type="button" data-toggle="responsive-menu"></button>
    <div class="title-bar-title invisible">Menu</div>
</nav>
<nav class="top-bar" id="responsive-menu">
    <div class="top-bar-right no-js">
        <ul class="dropdown menu vertical medium-horizontal large-horizontal" data-active-class="active" data-hover-delay="150" data-closing-time="80" data-alignment="left"
            data-dropdown-menu data-smooth-scroll>
            
            
            
            
            
                <li class=" ">
                    <a href="/" >
                        Home
                    </a>
                </li>
            
            
            
            
            
            
                <li class=" ">
                    <a href="/posts/" >
                        Blog posts
                    </a>
                </li>
            
            
            
            
            
            
                <li class=" ">
                    <a href="/talks/" >
                        Talks
                    </a>
                </li>
            
            
            
            
            
            
                <li class="show-for-small-only ">
                    <a href="/portfolio/" >
                        Portfolio
                    </a>
                </li>
            
            
                <li class="hide-for-small-only is-dropdown-submenu-parent ">
                    <a href="/portfolio/" >
                        Portfolio
                    </a>
                <ul class="vertical menu nested submenu">
                    
                    
                    <li >
                        <a href="/portfolio/#httpretty" title="httpretty">
                            httpretty
                        </a>
                    </li>
                    
                    
                    <li >
                        <a href="/portfolio/#wedeploy" title="WeDeploy CLI Tool">
                            WeDeploy CLI Tool
                        </a>
                    </li>
                    
                    
                    <li >
                        <a href="/portfolio/#vehikel" title="Vehikel">
                            Vehikel
                        </a>
                    </li>
                    
                    
                    <li >
                        <a href="/portfolio/#tic-tac-toe" title="Tic-tac-toe">
                            Tic-tac-toe
                        </a>
                    </li>
                    
                    
                    <li >
                        <a href="/portfolio/#accidents" title="accidents">
                            accidents
                        </a>
                    </li>
                    
                    
                    <li >
                        <a href="/portfolio/#topostit" title="to-post.it">
                            to-post.it
                        </a>
                    </li>
                    
                    
                    <li >
                        <a href="/portfolio/#trazqueeupago" title="trazqueeupago.com">
                            trazqueeupago.com
                        </a>
                    </li>
                    
                    
                    <li >
                        <a href="/portfolio/#cahier" title="Cahier">
                            Cahier
                        </a>
                    </li>
                    
                    
                    <li >
                        <a href="/portfolio/#plifk" title="Plifk">
                            Plifk
                        </a>
                    </li>
                    
                </ul>
                </li>
            
            
            
            
            
                <li class=" ">
                    <a href="/opensource/" >
                        Open Source
                    </a>
                </li>
            
            
            
            
            
            
                <li class=" ">
                    <a href="/favorites/" >
                        Favorites
                    </a>
                </li>
            
            
            
            
            
            
                <li class=" ">
                    <a href="/about/" >
                        About me
                    </a>
                </li>
            
            
            
            
            
            
            
            
            <li><a href="/resume.pdf" class="button-resume">Résumé</a></li>
        </ul>
    </div>
</nav>

        <div class="cell medium-auto medium-cell-block-container">
            <div class="grid-x grid-padding-x">
                <div class="nav cell large-3 medium-4 large-cell-block-y medium-cell-block-y"><div itemscope itemtype="http://schema.org/Person">
    <div class="nav-card grid-x">
        <div class="cell small-2 medium-12 nav-card-photo-cell">
            <a href="/" itemprop="photo" class="nav-card-photo">
                <img src="/img/me_at_gullfoss_cropped.jpg" alt="me at Gullfoss" width="549" height="549" />
            </a>
        </div>
        <div class="cell card-section small-10 medium-12 medium-text-center">
            <h4 itemprop="name">Henrique Vicente</h4>
            <p>
                <span itemprop="title">Software Engineer</span>
            </p>
        </div>
    </div>
    <ul class="nav-about-me no-bullet">
        
        <li>
            <p>I'm a Software Engineer from Brazil. I live in The&nbsp;Hague,&nbsp;Netherlands, and I work for <a href="https://hatchstudio.co/" itemprop="affiliation">HATCH</a>&nbsp;(a part of <a href="https://www.pvh.com/">PVH</a>),
                working on a Digital Showroom for wholesale fashion brands (such as <a href="https://www.tommy.com/">Tommy Hilfiger</a> and <a href="https://www.calvinklein.com/">Calvin Klein</a>).<br /><br />
                I mostly use the amazing Go programming language. I enjoy photography, drones, and traveling.</p>
        </li>
        
        <li>
            <a href="https://keybase.io/henvic" class="fingerprint" title="Keybase profile">D0F4<span
                    class="space"></span>DFBD<span class="space"></span>257C<span class="space"></span>1575</a>
        </li>
    </ul>
    <div class="menu-social">
        <a class="webicon github" href="https://github.com/henvic">
            GitHub
        </a>
        <a class="webicon twitter" href="https://twitter.com/henriquev">
            Twitter
        </a>
        <a class="webicon linkedin" href="https://www.linkedin.com/in/henvic">
            Linkedin
        </a>
        <a class="webicon instagram" href="https://www.instagram.com/henvic/">
            Instagram
        </a>
        <a class="webicon flickr" href="https://www.flickr.com/photos/henriquev/">
            Flickr
        </a>
        <a class="webicon mail" href="mailto:henriquevicente@gmail.com" itemprop="email">
            henriquevicente@gmail.com
        </a>
    </div>
    
</div>
</div>

<article class="cell large-9 medium-8 large-cell-block-y medium-cell-block-y main">
        <h1 class="post-title">UTF-8 strings with Go: len(s) isn&#39;t enough</h1>
        
        
        <p class="post-date">Posted in <time class="stat" datetime="2022-03-07 00:00:00 &#43;0000 UTC"></time>Monday, 7 March 2022</time>.</p>
        
        <p>In this post, I show you the bare minimum you need to know how to do UTF-8 string manipulation in Go safely.</p>
<p><small>Read also: <a href="/posts/go-postgres/">Back to basics: Writing an application using Go and PostgreSQL</a> and <a href="/posts/homelab/">Homelab: Intel NUC with the ESXi hypervisor</a>.</small></p>
<h1 id="tldr">tl;dr</h1>
<p>Use the <code>unicode/utf8</code> <a href="https://pkg.go.dev/unicode/utf8">package</a> to:</p>
<ol>
<li>Validate if string isn&rsquo;t in another encoding or corrupted:</li>
</ol>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">utf8</span>.<span style="color:#a6e22e">ValidString</span>(<span style="color:#a6e22e">s</span>))
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>Get the right number of runes in a UTF-8 string:</li>
</ol>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">utf8</span>.<span style="color:#a6e22e">RuneCountInString</span>(<span style="color:#e6db74">&#34;é um cãozinho&#34;</span>)) <span style="color:#75715e">// returns 13 as expected
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(len(<span style="color:#e6db74">&#34;é um cãozinho&#34;</span>)) <span style="color:#75715e">// returns 15 because &#39;é&#39; and &#39;ã&#39; are represented by two bytes each
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>Strings might get corrupted if you try to slice them incorrectly:</li>
</ol>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;unicode/utf8&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">dog</span> = <span style="color:#e6db74">&#34;é um cãozinho&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">dog</span> = <span style="color:#a6e22e">dog</span>[<span style="color:#ae81ff">1</span>:]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;got: %q (valid: %v)\n&#34;</span>, <span style="color:#a6e22e">dog</span>, <span style="color:#a6e22e">utf8</span>.<span style="color:#a6e22e">ValidString</span>(<span style="color:#a6e22e">dog</span>))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Output:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// got: &#34;� um cãozinho&#34; (valid: false)
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>To slice them correctly, use <code>utf8.DecodeRune</code> or <code>utf8.DecodeRuneInString</code> to get the first rune and its size:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">dog</span> = <span style="color:#e6db74">&#34;é um cãozinho&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">offset</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">utf8</span>.<span style="color:#a6e22e">DecodeRuneInString</span>(<span style="color:#a6e22e">dog</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">dog</span> = <span style="color:#a6e22e">dog</span>[<span style="color:#a6e22e">offset</span>:]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;got: %q (valid: %v)\n&#34;</span>, <span style="color:#a6e22e">dog</span>, <span style="color:#a6e22e">utf8</span>.<span style="color:#a6e22e">ValidString</span>(<span style="color:#a6e22e">dog</span>))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Output:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// got: &#34; um cãozinho&#34; (valid: true)
</span></span></span></code></pre></td></tr></table>
</div>
</div><h1 id="background">Background</h1>
<p>In the early days of the web, websites from different regions used different <a href="https://en.wikipedia.org/wiki/Character_encoding">character encodings</a>, accordingly to their demographic region. Nowadays, most websites use the <a href="https://en.wikipedia.org/wiki/Unicode">Unicode</a> implementation known as UTF-8. Unicode defines 144,697 characters.
Here are some of the most popular encodings:</p>
<table>
<thead>
<tr>
<th>Encoding</th>
<th>Use</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://en.wikipedia.org/wiki/UTF-8">UTF-8</a></td>
<td>Unicode Standard (International)</td>
</tr>
<tr>
<td><a href="https://en.wikipedia.org/wiki/ISO/IEC_8859-1">ISO-8859-1</a></td>
<td>Western European languages (includes English)</td>
</tr>
<tr>
<td><a href="https://en.wikipedia.org/wiki/ISO/IEC_8859-2">ISO-8859-2</a></td>
<td>Eastern European languages</td>
</tr>
<tr>
<td><a href="https://en.wikipedia.org/wiki/ISO/IEC_8859-5">ISO-8859-5</a></td>
<td>Cyrillic languages</td>
</tr>
<tr>
<td><a href="https://en.wikipedia.org/wiki/GB_2312">GB 2312</a></td>
<td>Simplified Chinese</td>
</tr>
<tr>
<td><a href="https://en.wikipedia.org/wiki/Shift_JIS">Shift JIS</a></td>
<td>Japanese</td>
</tr>
<tr>
<td><a href="https://en.wikipedia.org/wiki/Windows_code_page">Windows-125x series</a></td>
<td>Windows code pages: characters sets for multiple languages</td>
</tr>
<tr>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>
</tbody>
</table>
<p>UTF-8 was created in 1992 by Ken Thompson and Rob Pike as a variable-width character encoding, originally implemented for the <a href="https://en.wikipedia.org/wiki/Plan_9_from_Bell_Labs">Plan 9</a> operating system. It is backward-compatible with ASCII. As of 2022, more than 97% of the content on the web is encoded with UTF-8.
See:</p>
<ul>
<li><a href="https://googleblog.blogspot.com/2012/02/unicode-over-60-percent-of-web.html">Unicode over 60 percent of the web</a> (Google, February 3, 2012)</li>
<li><a href="https://w3techs.com/technologies/history_overview/character_encoding/ms/y">Historical yearly trends in the usage statistics of character encodings for websites</a> (since 2011)</li>
</ul>
<h1 id="why-should-you-care">Why should you care?</h1>
<p>Take a language with just a few extra glyphs like Portuguese or Spanish, and you&rsquo;ll quickly notice the importance of handling encodings properly when writing software.
To show that, let me write a small program that will iterate over a string rune by rune <a href="https://go.dev/blog/strings">assuming it is UTF-8</a> and print its representation:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;unicode/utf8&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">examples</span> = <span style="color:#e6db74">&#34;abcdeáãàâéíóõúûüç世界😁&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">c</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">examples</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%#U\tdecimal: %d\tbinary: %b \tbytes: %d\n&#34;</span>, <span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">utf8</span>.<span style="color:#a6e22e">RuneLen</span>(<span style="color:#a6e22e">c</span>))
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Output:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// U+0061 &#39;a&#39;	decimal: 97	binary: 1100001 		bytes: 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// U+0062 &#39;b&#39;	decimal: 98	binary: 1100010 		bytes: 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// U+0063 &#39;c&#39;	decimal: 99	binary: 1100011 		bytes: 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// U+0064 &#39;d&#39;	decimal: 100	binary: 1100100 		bytes: 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// U+0065 &#39;e&#39;	decimal: 101	binary: 1100101 		bytes: 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// U+00E1 &#39;á&#39;	decimal: 225	binary: 11100001 		bytes: 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// U+00E3 &#39;ã&#39;	decimal: 227	binary: 11100011 		bytes: 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// U+00E0 &#39;à&#39;	decimal: 224	binary: 11100000 		bytes: 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// U+00E2 &#39;â&#39;	decimal: 226	binary: 11100010 		bytes: 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// U+00E9 &#39;é&#39;	decimal: 233	binary: 11101001 		bytes: 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// U+00ED &#39;í&#39;	decimal: 237	binary: 11101101 		bytes: 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// U+00F3 &#39;ó&#39;	decimal: 243	binary: 11110011 		bytes: 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// U+00F5 &#39;õ&#39;	decimal: 245	binary: 11110101 		bytes: 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// U+00FA &#39;ú&#39;	decimal: 250	binary: 11111010 		bytes: 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// U+00FB &#39;û&#39;	decimal: 251	binary: 11111011 		bytes: 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// U+00FC &#39;ü&#39;	decimal: 252	binary: 11111100 		bytes: 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// U+00E7 &#39;ç&#39;	decimal: 231	binary: 11100111 		bytes: 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// U+4E16 &#39;世&#39;	decimal: 19990	binary: 100111000010110 	bytes: 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// U+754C &#39;界&#39;	decimal: 30028	binary: 111010101001100 	bytes: 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// U+1F601 &#39;😁&#39;	decimal: 128513	binary: 11111011000000001 	bytes: 4
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Each of these preceding single characters is represented by what in <a href="https://en.wikipedia.org/wiki/Character_encoding">character encoding</a> terminology is called a <a href="https://en.wikipedia.org/wiki/Code_point">code point</a>, a numeric value that computers use to map, transmit, and store.
Now, UTF-8 is a <a href="https://en.wikipedia.org/wiki/Variable-width_encoding">variable-width encoding</a> requiring one to four bytes (that is, 8, 16, 24, or 32 bits) to represent a single <del>character</del> code point.
UTF-8 uses one byte for the first 128 code points (backward-compatible with ASCII), and up to 4 bytes for the rest.
While UTF-8 and many other encodings, such as ISO-8859-1, are backward-compatible with ASCII, their extended codespace aren&rsquo;t compatible between themselves.</p>
<blockquote>
<p>In the Go world, a code point is called a rune.</p>
</blockquote>
<p>From Go&rsquo;s <a href="https://cs.opensource.google/go/go/+/master:src/builtin/builtin.go;l=90-92">src/builtin/builtin.go</a> definition of rune, we can see it uses an int32 internally for each code point:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// rune is an alias for int32 and is equivalent to int32 in all ways. It is
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// used, by convention, to distinguish character values from integer values.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">rune</span> = <span style="color:#66d9ef">int32</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="how-can-this-affect-you-anyway">How can this affect you, anyway?</h1>
<p>In the early days of the web (though this problem might happen elsewhere), whenever you tried to access content from another demographics for which your computer vendor didn&rsquo;t prepare it to handle, you&rsquo;d likely get a long series of □ or � replacement characters on your browser.</p>
<p>If you wanted to display, say, Japanese or Cyrillic correctly, not only you&rsquo;d have to download a new font:
There was also a high chance of the website not setting encoding correctly, forcing you to manually adjust it on your browser (and hope it works).</p>
<h1 id="unicodeutf8">unicode/utf8</h1>
<p>With Unicode and UTF-8, this became a problem of the past.
Surely, I still cannot read any non-Latin language, but at least everyone&rsquo;s computers now render beautiful Japanese or Chinese calligraphy just fine out of the box.</p>
<p>From a software development perspective, we need to be aware of several problems, such as how to handle strings manipulation correctly, as we don&rsquo;t want to cause data corruption.</p>
<p>For that, when working with UTF-8 in Go, if you need to do any sort of string manipulation, such as truncating a long string, you&rsquo;ll want to use the <a href="https://pkg.go.dev/unicode/utf8">unicode/utf8 package</a>.</p>
<p><strong>Length of a string vs. the number of runes:</strong>
What is the length of the following words?</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;unicode/utf8&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">examples</span> = []<span style="color:#66d9ef">string</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;dog&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;cão&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;pa&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;pá&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;pà&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;Hello, World&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;Hello, 世界&#34;</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">w</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">examples</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%s\tlen: %d\trunes: %d\n&#34;</span>, <span style="color:#a6e22e">w</span>, len(<span style="color:#a6e22e">w</span>), <span style="color:#a6e22e">utf8</span>.<span style="color:#a6e22e">RuneCountInString</span>(<span style="color:#a6e22e">w</span>))
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Output:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">dog</span>	<span style="color:#a6e22e">len</span>: <span style="color:#ae81ff">3</span>	<span style="color:#a6e22e">runes</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cão</span>	<span style="color:#a6e22e">len</span>: <span style="color:#ae81ff">4</span>	<span style="color:#a6e22e">runes</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">pa</span>	<span style="color:#a6e22e">len</span>: <span style="color:#ae81ff">2</span>	<span style="color:#a6e22e">runes</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">pá</span>	<span style="color:#a6e22e">len</span>: <span style="color:#ae81ff">3</span>	<span style="color:#a6e22e">runes</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">pà</span>	<span style="color:#a6e22e">len</span>: <span style="color:#ae81ff">3</span>	<span style="color:#a6e22e">runes</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Hello</span>, <span style="color:#a6e22e">World</span>	<span style="color:#a6e22e">len</span>: <span style="color:#ae81ff">12</span>	<span style="color:#a6e22e">runes</span>: <span style="color:#ae81ff">12</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Hello</span>, <span style="color:#a6e22e">世界</span>	<span style="color:#a6e22e">len</span>: <span style="color:#ae81ff">13</span>	<span style="color:#a6e22e">runes</span>: <span style="color:#ae81ff">9</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>As you can see, len cannot be used to count the number of runes properly.
Instead, you must use the following functions:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">utf8</span>.<span style="color:#a6e22e">RuneCount</span>(<span style="color:#a6e22e">p</span> []<span style="color:#66d9ef">byte</span>) <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">utf8</span>.<span style="color:#a6e22e">RuneCountInString</span>(<span style="color:#a6e22e">s</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">n</span> <span style="color:#66d9ef">int</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>To validate if a string is consists entirely of valid UTF-8-encoded runes use the following functions:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">utf8</span>.<span style="color:#a6e22e">Valid</span>(<span style="color:#a6e22e">p</span> []<span style="color:#66d9ef">byte</span>) <span style="color:#66d9ef">bool</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">utf8</span>.<span style="color:#a6e22e">ValidRune</span>(<span style="color:#a6e22e">r</span> <span style="color:#66d9ef">rune</span>) <span style="color:#66d9ef">bool</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">utf8</span>.<span style="color:#a6e22e">ValidString</span>(<span style="color:#a6e22e">s</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">bool</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Example:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">utf8</span>.<span style="color:#a6e22e">ValidString</span>(<span style="color:#e6db74">&#34;isso é um exemplo&#34;</span>)) <span style="color:#75715e">// Should print true.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">utf8</span>.<span style="color:#a6e22e">ValidString</span>(<span style="color:#e6db74">&#34;\xe0&#34;</span>)) <span style="color:#75715e">// Should print false.
</span></span></span></code></pre></td></tr></table>
</div>
</div><h1 id="converting-between-encodings">Converting between encodings</h1>
<p>To convert to/from other encodings, you might use the <a href="https://pkg.go.dev/golang.org/x/text/encoding/charmap">golang.org/x/text/encoding/charmap package</a>.</p>
<p>Example:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;unicode/utf8&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;golang.org/x/text/encoding/charmap&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">invalid</span> = <span style="color:#e6db74">&#34;\xe0 \xe1 \xe2 \xe3 \xe9&#34;</span> <span style="color:#75715e">// this is &#34;à á â ã é&#34; in ISO-8859-1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Not UTF-8: %q (valid: %v)\n&#34;</span>, <span style="color:#a6e22e">invalid</span>, <span style="color:#a6e22e">utf8</span>.<span style="color:#a6e22e">ValidString</span>(<span style="color:#a6e22e">invalid</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// If we convert it from ISO8859-1 to UTF-8:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">dec</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">charmap</span>.<span style="color:#a6e22e">ISO8859_1</span>.<span style="color:#a6e22e">NewDecoder</span>().<span style="color:#a6e22e">String</span>(<span style="color:#a6e22e">invalid</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Decoded: %q (valid UTF8: %v)\n&#34;</span>, <span style="color:#a6e22e">dec</span>, <span style="color:#a6e22e">utf8</span>.<span style="color:#a6e22e">ValidString</span>(<span style="color:#a6e22e">dec</span>))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Output:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Not UTF-8: &#34;\xe0 \xe1 \xe2 \xe3 \xe9&#34; (valid: false)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Decoded: &#34;à á â ã é&#34; (valid UTF8: true)
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>If you need help reading a malformed string, or getting runes individually, read the documentation for the <a href="https://pkg.go.dev/unicode/utf8">unicode/utf8 package</a> and check out its examples.</p>
<h1 id="references">References</h1>
<ul>
<li><a href="https://go.dev/blog/strings">Strings, bytes, runes and characters in Go</a> by Rob Pike.</li>
<li><a href="https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/">The Absolute Minimum Every Software Developer Absolutely, Positively Must Know About Unicode and Character Sets (No Excuses!)</a> by Joel Spolsky.</li>
</ul>

                <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large"
                        data-text="UTF-8 strings with Go: len(s) isn&#39;t enough" data-url="https://henvic.dev/posts/go-utf8/" data-via="henriquev"
                        data-hashtags="golang"  data-show-count="false">Tweet</a>
                        <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
        <aside class="read-also">
                <h3>Read also</h3>
                <ul>
                        
                        <li>
                                <a href="/posts/go-postgres/">Back to basics: Writing an application using Go and PostgreSQL</a>
                                <time datetime="2006-01-02">Monday 22, November 2021</time>
                        </li>
                        <li>
                                <a href="/posts/postgres-14-freebsd-13/">Upgrading to PostgreSQL 14 on FreeBSD 13</a>
                                <time datetime="2006-01-02">Thursday 11, November 2021</time>
                        </li>
                        <li>
                                <a href="/posts/uuid/">You don&#39;t need UUID</a>
                                <time datetime="2006-01-02">Sunday 30, May 2021</time>
                        </li>
                        <li>
                                <a href="/posts/bitcoin-pt/">Crise das tulipas: Bitcoin é uma péssima idéia</a>
                                <time datetime="2006-01-02">Thursday 13, May 2021</time>
                        </li>
                        <li>
                                <a href="/posts/bitcoin/">Cryptocurrency Tulipmania: Bitcoin is a shitcoin</a>
                                <time datetime="2006-01-02">Monday 10, May 2021</time>
                        </li>
                        <li>
                                <a href="/posts/go/">The ecosystem of the Go programming language</a>
                                <time datetime="2006-01-02">Monday 22, March 2021</time>
                        </li>
                        <li>
                                <a href="/posts/my-go-mistakes/">My Go mistakes</a>
                                <time datetime="2006-01-02">Thursday 18, February 2021</time>
                        </li>
                        <li>
                                <a href="/posts/env/">Environment variables, config, secrets, and globals</a>
                                <time datetime="2006-01-02">Saturday 16, January 2021</time>
                        </li>
                        <li>
                                <a href="/posts/signal-notify-context/">signal.NotifyContext: handling cancelation with Unix signals using context</a>
                                <time datetime="2006-01-02">Wednesday 16, September 2020</time>
                        </li>
                        <li>
                                <a href="/posts/e-commerce/">I&#39;m starting an opensource e-commerce project.</a>
                                <time datetime="2006-01-02">Wednesday 17, June 2020</time>
                        </li>
                        <li>
                                <a href="/posts/cs-security/">Counter-Strike code leaked: should you worry? What if your code leaks? Learn how to deliver software securely.</a>
                                <time datetime="2006-01-02">Wednesday 22, April 2020</time>
                        </li>
                        <li>
                                <a href="/posts/homelab/">Homelab: Intel NUC with the ESXi hypervisor</a>
                                <time datetime="2006-01-02">Monday 20, April 2020</time>
                        </li>
                </ul>
        </aside>
</article>

            </div>
        </div>
    </div>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-43519325-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<script src="/js/vendor/modernizr-custom-svg.js"></script>
<script src="/js/vendor/what-input.js"></script>
<script src="/js/vendor/jquery.min.js"></script>
<script src="/js/vendor/foundation.min.js"></script>
<script>
        $(document).ready(function () {
                $(document).foundation();
        });
</script>
</body>
</html>
